<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />

  <link rel="manifest" href="./manifest.json" />
  <title>ELDRITCH</title>

  <style>
    :root{
      --safe-b: env(safe-area-inset-bottom);

      --ink-output: #D7C6A6;
      --ink-input:  #FFD36A;

      --bg:  #060503;
      --bg2: #0B0906;

      --panel:  rgba(20, 16, 10, 0.78);
      --panel2: rgba(26, 21, 13, 0.70);

      --border:  rgba(255, 214, 122, 0.18);
      --border2: rgba(255, 214, 122, 0.12);

      --t-white:  #E6E6E6;
      --t-green:  #3DFF6B;
      --t-blue:   #4DA3FF;
      --t-yellow: #FFD24A;
      --t-red:    #FF4A4A;
      --t-elite:  #C45BFF;
      --t-boss:   #FF2E88;
      --t-world:  #FF8A00;

      --c-platinum:#CFE9FF;
      --c-gold:    #FFD36A;
      --c-silver:  #C9D2DA;
      --c-copper:  #C87A3A;

      --font-output: "Palatino Linotype", Palatino, "Book Antiqua", Georgia, serif;
      --font-input: "Segoe Script", "Bradley Hand", "Comic Sans MS", "Apple Chancery", "Snell Roundhand", cursive;
      --font-ui: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    html, body{
      margin: 0;
      padding: 0;
      height: 100%;
      background:
        radial-gradient(1200px 900px at 50% -20%, rgba(255,138,0,0.10), transparent 55%),
        radial-gradient(900px 900px at 90% 110%, rgba(196,91,255,0.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color: var(--ink-output);
      font-family: var(--font-ui);
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #topbar{
      display: flex;
      gap: 8px;
      padding: 10px;
      border-bottom: 1px solid rgba(255,214,122,0.14);
      background: linear-gradient(180deg, rgba(20,16,10,0.85), rgba(10,8,6,0.85));
      user-select: none;
      -webkit-user-select: none;
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    #topbar::-webkit-scrollbar{ height: 0px; }

    .tab{
      padding: 7px 12px;
      border: 1px solid rgba(255,214,122,0.18);
      border-radius: 14px;
      background: rgba(15,12,8,0.85);
      color: var(--ink-output);
      font-family: var(--font-ui);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: 0.6px;
      cursor: pointer;
      touch-action: manipulation;
      white-space: nowrap;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.35) inset;
    }

    .tab.active{
      background: radial-gradient(500px 80px at 50% 50%, rgba(255,214,122,0.22), rgba(15,12,8,0.88));
      border-color: rgba(255,214,122,0.45);
      color: var(--ink-input);
      text-shadow: 0 0 10px rgba(255,138,0,0.18);
    }

    #viewport{
      height: calc(100% - 60px);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #contentScroll{
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 14px;
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
    }

    .panel{
      position: relative;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      margin: 0 0 14px 0;
      background:
        radial-gradient(900px 220px at 15% 0%, rgba(255,214,122,0.08), transparent 50%),
        radial-gradient(700px 220px at 85% 100%, rgba(255,138,0,0.06), transparent 55%),
        linear-gradient(180deg, var(--panel), var(--panel2));
      box-shadow:
        0 14px 28px rgba(0,0,0,0.35),
        0 0 0 1px rgba(0,0,0,0.35) inset;
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius: 12px;
      border: 1px dashed rgba(255,214,122,0.10);
      pointer-events:none;
      opacity:0.7;
    }

    .panelTitle{
      font-family: var(--font-ui);
      font-weight: 900;
      font-size: 12px;
      margin: 0 0 8px 0;
      letter-spacing: 0.8px;
      color: var(--ink-input);
      opacity: 0.95;
    }

    .mono{
      font-family: var(--font-output);
      white-space: pre-wrap;
      word-break: break-word;
      line-height: 1.55;
      font-size: 15px;
      color: var(--ink-output);
      letter-spacing: 0.1px;
      text-shadow:
        0 0 1px rgba(0,0,0,0.35),
        0 1px 0 rgba(0,0,0,0.25);
    }

    .logLine{
      margin: 0 0 8px 0;
      color: rgba(215,198,166,0.95);
      font-family: var(--font-ui);
      text-shadow: none;
    }

    #inputBar{
      display: flex;
      align-items: flex-end;
      gap: 10px;
      padding: 10px 10px calc(10px + var(--safe-b)) 10px;
      border-top: 1px solid rgba(255,214,122,0.14);
      background: linear-gradient(180deg, rgba(12,10,7,0.92), rgba(8,6,4,0.92));
      box-sizing: border-box;
    }

    #input{
      flex: 1;
      resize: none;
      border: none;
      outline: none;
      background: transparent;
      color: var(--ink-input);
      font-family: var(--font-input);
      font-size: 18px;
      line-height: 1.35;
      max-height: 160px;
      overflow-y: auto;
      padding: 0;
      margin: 0;
      caret-color: var(--ink-input);
      text-shadow:
        0 0 6px rgba(255,138,0,0.18),
        0 0 1px rgba(0,0,0,0.35);
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    #input::placeholder{
      color: rgba(255,214,122,0.45);
      font-family: var(--font-output);
      text-shadow: none;
    }

    #sendBtn{
      border: none;
      background: radial-gradient(120px 60px at 50% 40%, rgba(255,214,122,0.55), rgba(255,138,0,0.35));
      color: #1a120a;
      font-weight: 900;
      border-radius: 18px;
      padding: 10px 14px;
      min-width: 46px;
      cursor: pointer;
      touch-action: manipulation;
      box-shadow:
        0 10px 18px rgba(0,0,0,0.35),
        0 0 0 1px rgba(255,214,122,0.22) inset;
      font-family: var(--font-ui);
    }

    #actionBar{
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 10px calc(10px + var(--safe-b)) 10px;
      border-top: 1px solid rgba(255,214,122,0.14);
      background: linear-gradient(180deg, rgba(12,10,7,0.92), rgba(8,6,4,0.92));
      box-sizing: border-box;
    }

    .actionBtn{
      flex: 1;
      border: none;
      border-radius: 14px;
      padding: 12px 10px;
      font-weight: 900;
      cursor: pointer;
      touch-action: manipulation;
      box-shadow: 0 10px 18px rgba(0,0,0,0.28);
      font-family: var(--font-ui);
    }

    #cancelBtn{
      background: rgba(20,16,10,0.85);
      color: var(--ink-output);
      border: 1px solid rgba(255,214,122,0.14);
    }
    #execBtn{
      background: radial-gradient(140px 60px at 50% 40%, rgba(255,214,122,0.60), rgba(255,138,0,0.38));
      color: #1a120a;
    }

    .threat-white{color:var(--t-white)}
    .threat-green{color:var(--t-green)}
    .threat-blue{color:var(--t-blue)}
    .threat-yellow{color:var(--t-yellow)}
    .threat-red{color:var(--t-red)}
    .threat-elite{color:var(--t-elite)}
    .threat-boss{color:var(--t-boss)}
    .threat-world{color:var(--t-world)}

    .coin-platinum{color:var(--c-platinum)}
    .coin-gold{color:var(--c-gold)}
    .coin-silver{color:var(--c-silver)}
    .coin-copper{color:var(--c-copper)}
  </style>
</head>

<body>
  <div id="topbar">
    <button class="tab active" data-tab="WORLD">WORLD</button>
    <button class="tab" data-tab="STATUS">STATUS</button>
    <button class="tab" data-tab="INVENTORY">INVENTORY</button>
    <button class="tab" data-tab="SKILLS">SKILLS</button>
    <button class="tab" data-tab="MAPS">MAPS</button>
    <button class="tab" data-tab="NPC">NPC</button>
    <button class="tab" data-tab="LIFEJOB1">LIFE JOB 1</button>
    <button class="tab" data-tab="LIFEJOB2">LIFE JOB 2</button>
  </div>

  <div id="viewport">
    <div id="contentScroll"></div>
  </div>

  <div id="inputBar">
    <textarea id="input" rows="1" placeholder="Write your command..."></textarea>
    <button id="sendBtn" aria-label="Send">â†‘</button>
  </div>

  <div id="actionBar">
    <button id="cancelBtn" class="actionBtn">Cancel</button>
    <button id="execBtn" class="actionBtn">Execute</button>
  </div>

  <!-- BOOT WATCHDOG: prints if app.js never executes -->
  <script>
    (function () {
      window.__ELDRITCH_BOOTED = false;
      const fail = (title, body) => {
        const cs = document.getElementById("contentScroll");
        if (!cs) return;
        const esc = (s) => String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
        cs.innerHTML =
          '<section class="panel">' +
            '<div class="panelTitle">' + esc(title) + '</div>' +
            '<div class="mono">' + esc(body) + '</div>' +
          '</section>';
      };
      window.addEventListener("error", function (e) {
        fail("BOOT ERROR", (e && e.message) ? e.message : "Unknown error");
      });
      window.addEventListener("unhandledrejection", function (e) {
        fail("BOOT REJECTION", (e && e.reason) ? String(e.reason) : "Unhandled promise rejection");
      });
      setTimeout(function () {
        if (!window.__ELDRITCH_BOOTED) {
          fail(
            "BOOT TIMEOUT",
            "app.js did not boot. Likely cached/stale index.html, blocked script load, or SW serving an old response. Check app.js URL loads and add ?v bump."
          );
        }
      }, 1200);
    })();
  </script>

  <!-- CACHE-BUSTED + DEFER -->
  <script defer src="./app.js?v=32"></script>
</body>
</html>
